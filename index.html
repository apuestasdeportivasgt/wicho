<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Reproductor HLS Simple</title>
  <style>
    html,body{height:100%;margin:0;display:flex;align-items:center;justify-content:center;background:#000;color:#fff}
    video{width:90vw;height:60vh;background:#000;border:0}
    #playBtn{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);padding:12px 18px;font-size:16px;border-radius:8px;border:none;background:#0aa; color:#001; display:none;cursor:pointer}
    .note{position:fixed;left:10px;bottom:10px;font-size:13px;opacity:0.8}
  </style>
</head>
<body>
  <video id="video" controls playsinline></video>
  <button id="playBtn">Reproducir</button>
  <div class="note">Si el autoplay con sonido está bloqueado, pulsa "Reproducir".</div>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.1/dist/hls.min.js"></script>
  <script>
    const url = 'https://x4bnd7lq.fubohd.com/espndeportes/mono.m3u8?token=a38511cbf10da79d6ddf6e35f6730aa879fa0a22-18-1764722985-1764704985';
    const video = document.getElementById('video');
    const playBtn = document.getElementById('playBtn');

    // Intento de reproducción automática con sonido (puede ser bloqueado por el navegador)
    async function iniciar() {
      try {
        // Preferimos volumen 1.0 si el navegador lo permite
        video.volume = 1.0;
        video.muted = false;
        const playResult = await video.play();
        // si llega aquí, se reprodujo
        playBtn.style.display = 'none';
      } catch (err) {
        // autoplay con sonido fue bloqueado -> mostrar botón para que el usuario inicie
        playBtn.style.display = 'block';
      }
    }

    if (Hls.isSupported()) {
      const hls = new Hls();
      hls.loadSource(url);
      hls.attachMedia(video);
      hls.on(Hls.Events.MANIFEST_PARSED, function() {
        iniciar();
      });
      hls.on(Hls.Events.ERROR, function(event, data) {
        console.warn('HLS error', data);
      });
    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
      // Safari / iOS
      video.src = url;
      video.addEventListener('loadedmetadata', iniciar);
    } else {
      alert('Este navegador no soporta reproducción HLS y hls.js no está disponible.');
    }

    // Si el usuario pulsa el botón, forzamos reproducción y activamos audio
    playBtn.addEventListener('click', async () => {
      try {
        video.muted = false;
        video.volume = 1.0;
        await video.play();
        playBtn.style.display = 'none';
      } catch(e) {
        console.error('No se pudo reproducir:', e);
      }
    });

    // Intento adicional: si el usuario interactúa con la página, reintentar
    window.addEventListener('click', function once() { iniciar(); window.removeEventListener('click', once); }, { once: true });
  </script>
</body>
</html>
