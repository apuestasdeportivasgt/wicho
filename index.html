<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reproductor HLS — Disney20</title>
  <style>
    :root{--bg:#0b0b0b;--panel:#0f1720;--muted:#9aa4b2}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#071021 0%,#071422 100%);color:#fff}
    .player-wrap{width:min(1100px,96vw);max-width:1100px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));padding:18px;border-radius:14px;box-shadow:0 8px 30px rgba(2,6,23,0.6)}
    .title{font-size:18px;margin:0 0 10px 0}
    .video-container{position:relative;padding-top:56.25%;background:#000;border-radius:8px;overflow:hidden}
    video{position:absolute;top:0;left:0;width:100%;height:100%;display:block;background:#000}
    .controls{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-top:10px}
    .left-controls{display:flex;gap:8px;align-items:center}
    button{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;color:inherit;cursor:pointer}
    input[type=range]{width:160px}
    .meta{font-size:13px;color:var(--muted)}
    .notice{margin-top:8px;font-size:13px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="player-wrap">
    <div class="card">
      <h1 class="title">Reproductor HLS — TV EN VIVO</h1>
      <div class="video-container">
        <video id="video" controls playsinline preload="metadata" autoplay muted></video>
      </div>

      <div class="controls">
        <div class="left-controls">
          <button id="play">Play/Pause</button>
          <button id="mute">Mute</button>
          <label class="meta">Velocidad:</label>
          <select id="speed">
            <option value="0.5">0.5×</option>
            <option value="0.75">0.75×</option>
            <option value="1" selected>1×</option>
            <option value="1.25">1.25×</option>
            <option value="1.5">1.5×</option>
            <option value="2">2×</option>
          </select>
        </div>
        <div class="right-controls">
          <label class="meta">Calidad:</label>
          <select id="quality"><option>Auto</option></select>
        </div>
      </div>

      <div class="notice">Si tu navegador no reproduce HLS nativamente (Chrome/Firefox), el reproductor usa hls.js para forzar la reproducción. En Safari la reproducción HLS es nativa.</div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.2/dist/hls.min.js"></script>
  <script>
    // URL proporcionada
    const streamUrl = 'https://bgfuzq.fubohd.com/disney20/mono.m3u8?token=851abb452279d1c1163831da7d8e1badd983d7c8-6d-1764033282-1764015282';

    const video = document.getElementById('video');
    const playBtn = document.getElementById('play');
    const muteBtn = document.getElementById('mute');
    const speedSel = document.getElementById('speed');
    const qualitySel = document.getElementById('quality');

    function setupNative(){
      video.src = streamUrl;
      video.addEventListener('loadedmetadata', ()=>{
        console.log('Metadata loaded (native)');
      });
    }

    function setupHls(){
      if(Hls.isSupported()){
        const hls = new Hls({capLevelToPlayerSize:true});
        hls.loadSource(streamUrl);
        hls.attachMedia(video);

        hls.on(Hls.Events.MANIFEST_PARSED, function(evt, data) {
          // rellenar opciones de calidad
          const levels = hls.levels || [];
          qualitySel.innerHTML = '<option value="-1">Auto</option>' + levels.map((l,i)=>`<option value="${i}">${l.height||'auto'}p ${l.bitrate?Math.round(l.bitrate/1000)+'kbps':''}</option>`).join('');
        });

        qualitySel.addEventListener('change', ()=>{
          const val = parseInt(qualitySel.value,10);
          hls.currentLevel = isNaN(val) ? -1 : val;
        });

        hls.on(Hls.Events.ERROR, function(event, data) {
          console.error('HLS error', data);
        });

        return hls;
      } else if (video.canPlayType('application/vnd.apple.mpegurl')){
        setupNative();
      } else {
        console.error('HLS no soportado');
      }
    }

    // Intento de autoplay seguro
video.muted = true;
video.autoplay = true;
video.addEventListener('canplay', ()=>{
  video.play().catch(()=>{});
});

// Inicialización
    if (Hls.isSupported()){
      setupHls();
    } else if (video.canPlayType('application/vnd.apple.mpegurl')){
      setupNative();
    } else {
      // show message to user
      const notice = document.createElement('div');
      notice.textContent = 'Tu navegador no soporta HLS y hls.js no está disponible.';
      document.querySelector('.card').appendChild(notice);
    }

    // Controles
    playBtn.addEventListener('click', ()=>{
      if(video.paused) video.play(); else video.pause();
    });

    muteBtn.addEventListener('click', ()=>{
      video.muted = !video.muted;
      muteBtn.textContent = video.muted ? 'Unmute' : 'Mute';
    });

    speedSel.addEventListener('change', ()=>{
      video.playbackRate = parseFloat(speedSel.value);
    });
  </script>
</body>
</html>
