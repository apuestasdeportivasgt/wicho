<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extractor de Stream M3U8 (GitHub Pages)</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h2 { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        label { font-weight: bold; margin-top: 15px; display: block; }
        input[type="text"], textarea { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        textarea { height: 250px; resize: vertical; margin-bottom: 15px; }
        button { background-color: #28a745; color: white; padding: 12px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button:hover { background-color: #218838; }
        #paso2, #paso3 { border: 1px dashed #007bff; padding: 15px; margin-top: 20px; border-radius: 5px; background-color: #f0f8ff; }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .note { background-color: #fff3cd; color: #856404; padding: 10px; border-radius: 4px; margin-top: 15px; }
    </style>
</head>
<body>

    <div class="container">
        <h2>üõ†Ô∏è Extractor de Stream M3U8</h2>
        
        <div class="note">
            ‚ö†Ô∏è **IMPORTANTE:** Por restricciones de seguridad del navegador (CORS), esta herramienta NO puede buscar autom√°ticamente. Debe seguir los pasos 1, 2 y 3.
        </div>
        
        <label for="urlPrincipal">1. Pega la URL del 'Embed' (e.g., de Futbol Libre):</label>
        <input type="text" id="urlPrincipal" placeholder="https://futbollibre.mx/embed/eventos.html?r=aHR0cHM6Ly9sYTE0aGQ..." onkeyup="decodificarURL()">
        
        <div id="paso2" style="display:none;">
            <label>2. Ve a esta URL decodificada y obt√©n el c√≥digo fuente:</label>
            <p>La URL interna (donde realmente est√° el stream) es:</p>
            <p><a id="urlDecodificada" href="#" target="_blank"></a></p>
            <p>
                ‚û°Ô∏è **Acci√≥n:** Haz clic en el enlace de arriba. En la nueva pesta√±a, presiona **Ctrl+U** (o ver c√≥digo fuente). **Copia todo el texto**.
            </p>
        </div>

        <div id="paso3" style="display:none;">
            <label for="codigoFuente">3. Pega el c√≥digo fuente que copiaste arriba:</label>
            <textarea id="codigoFuente" placeholder="Pega aqu√≠ el c√≥digo fuente completo del enlace decodificado..."></textarea>
            <button onclick="buscarEnlaces()">Buscar Enlaces M3U8</button>
            <div id="resultado"></div>
        </div>

    </div>

    <script>
        // Archivo script.js (l√≥gica interna)
        
        function decodificarURL() {
            const urlPrincipal = document.getElementById('urlPrincipal').value;
            const paso2 = document.getElementById('paso2');
            const paso3 = document.getElementById('paso3');
            const urlDecodificadaElement = document.getElementById('urlDecodificada');
            
            // Expresi√≥n regular para encontrar el valor del par√°metro 'r=' (que es Base64)
            const regexR = /[?&]r=([^&]*)/i;
            const match = urlPrincipal.match(regexR);

            if (match && match[1]) {
                try {
                    const base64 = match[1];
                    // Reemplazar caracteres no est√°ndar de URL para Base64 (si los hay)
                    const base64Limpio = base64.replace(/-/g, '+').replace(/_/g, '/');
                    
                    // Decodificar Base64
                    const urlDecodificada = atob(base64Limpio);
                    
                    urlDecodificadaElement.href = urlDecodificada;
                    urlDecodificadaElement.textContent = urlDecodificada;
                    paso2.style.display = 'block';
                    paso3.style.display = 'block';

                } catch (e) {
                    paso2.style.display = 'none';
                    paso3.style.display = 'none';
                    urlDecodificadaElement.textContent = "Error al decodificar Base64.";
                }
            } else {
                paso2.style.display = 'none';
                paso3.style.display = 'none';
            }
        }

        function buscarEnlaces() {
            const codigoFuente = document.getElementById('codigoFuente').value;
            const resultadoDiv = document.getElementById('resultado');
            
            resultadoDiv.innerHTML = "Buscando...";

            if (codigoFuente.length === 0) {
                resultadoDiv.innerHTML = "<p class='error'>Por favor, pega el c√≥digo fuente completo en el √°rea de texto.</p>";
                return;
            }

            // Expresi√≥n regular para buscar URLs que contengan '.m3u8'
            // Se asume que el enlace es una URL completa que termina en .m3u8 y puede llevar token
            const regex = /(https?:\/\/[^\s\'"]*\.m3u8[^\s\'"]*)/gi;

            let coincidencias = codigoFuente.match(regex);

            if (coincidencias && coincidencias.length > 0) {
                // Eliminar duplicados y unir para mostrar
                const enlacesUnicos = [...new Set(coincidencias)];
                
                let htmlResultado = `<p class='success'>‚úÖ ¬°${enlacesUnicos.length} enlace(s) .m3u8 encontrado(s)!</p>`;
                enlacesUnicos.forEach((enlace, index) => {
                    // Limpiar caracteres extra al inicio o final de la coincidencia
                    const enlaceLimpio = enlace.replace(/^['"]|['"]$/g, ''); 
                    htmlResultado += `<p><strong>Enlace ${index + 1}:</strong><br><code>${enlaceLimpio}</code></p>`;
                });

                resultadoDiv.innerHTML = htmlResultado;

            } else {
                resultadoDiv.innerHTML = "<p class='error'>‚ùå No se encontraron enlaces que coincidan con el patr√≥n .m3u8 en el texto pegado.</p>";
            }
        }
    </script>

</body>
</html>
